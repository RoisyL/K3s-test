name: K8S Github Action

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
    - uses: actions/checkout@v2
    - name: install k8s
      run: |
        # 检查 Docker
        docker info
        # 安装k3s
        curl -sfL https://get.k3s.io | K3S_KUBECONFIG_MODE=777 sh - 
        # 完善配置
        cat /etc/rancher/k3s/k3s.yaml
        mkdir -p ~/.kube
        cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
    - name: node check
      run: |
        # # 创建默认服务账号
        # kubectl create serviceaccount default -n default
        # # 检查服务状态
        # kubectl get serviceaccount default -n default
        # 检查集群运行情况
        sleep 2
        echo 集群运行情况：
        kubectl get nodes
    - name: pod test
      run: |
        # 创建一个容器
        kubectl run first-container --image=docker.io/library/nginx --port=80
        # 查看已创建pod状态
        sleep 30
        echo pod状态:
        kubectl get pods
    - name: container test
      run: |
        # 使用docker命令查看容器状态
        sleep 5
        docker ps
